<!DOCTYPE html>
<html>
  <head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">

    <title>In-person education status & COVID-19 case rates - COVID-19 Global Education Recovery Tracker</title>
    <meta name="description" content="Select a country to view detailed statistics about it, including education and population metrics, coronavirus cases, deaths, and vaccinations, and more.">

    <meta name="twitter:card" content="summary_large_image" />
    
    
    <meta name="twitter:title" content="In-person education status & COVID-19 case rates - COVID-19 Global Education Recovery Tracker" />
    <meta name="twitter:description" content="Select a country to view detailed statistics about it, including education and population metrics, coronavirus cases, deaths, and vaccinations, and more." />
    <meta name="twitter:image" content="https://www.covideducationrecovery.global//img/visualizations/in-person-status.jpg" />

    <meta property="og:title" content="In-person education status & COVID-19 case rates - COVID-19 Global Education Recovery Tracker">
    <meta property="og:image" content="https://www.covideducationrecovery.global//img/visualizations/in-person-status.jpg">
    <meta property="og:description" content="Select a country to view detailed statistics about it, including education and population metrics, coronavirus cases, deaths, and vaccinations, and more.">
    <meta property="og:url" content="https://www.covideducationrecovery.global//graphs/in-person-status/" />
    <meta property="og:type" content="website">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="/js/bootstrap.bundle.min.js" type="text/javascript"></script>
    <link href="/css/all.min.css" rel="stylesheet">
      
      
    <script src="/js/vue.min.js" type="text/javascript"></script>
      
      
      
    <script src="/js/d3.min.js" type="text/javascript"></script>
      
      
    <script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6/dist/tippy-bundle.umd.js"></script>
        
    

    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4XJB9Q7EK5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4XJB9Q7EK5');
    </script>
    

    <style>
     
      @font-face {
        font-family: 'FuturaPTWebLight';
        src:
          url('/webfonts/Futura-PT_Light.woff2') format('woff2'),
          url('/webfonts/Futura-PT_Light.woff') format('woff');
        font-weight: normal;
        font-style: normal;
      }
      @font-face {
        font-family: 'FuturaPTWebBook';
        src:
          url('/webfonts/Futura-PT_Book.woff2') format('woff2'),
          url('/webfonts/Futura-PT_Book.woff') format('woff');
        font-weight: normal;
        font-style: normal;
      }

      @font-face {
        font-family: 'FuturaPTWebDemi';
        src:
          url('/webfonts/Futura-PT_Demi.woff2') format('woff2'),
          url('/webfonts/Futura-PT_Demi.woff') format('woff');
        font-weight: normal;
        font-style: normal;
      }

      html, body {font-family: FuturaPTWebLight; font-size: 20px;}
      h1, h2, h3 {font-family: FuturaPTWebDemi;}
      strong, h4, h5, h6 {font-family: FuturaPTWebBook;}

      nav {min-height: 80px; font-family: FuturaPTWebDemi; font-size: 90%;}
      
      nav { background-color: var(--bs-light); }
      
      nav svg {width: 250px; height: 50px;}


      section {margin: 2em auto 1em auto; max-width: 1200px;}

      .navbar-brand {margin-right: 0.1rem;}

      .navbar-expand-xxl .navbar-nav {justify-content: space-evenly; width: 100%;}

      .spacer-10 {height: 10vh;}
      .spacer-5 {height: 5vh;}

      [marked] {background-color: green !important;}
      .table-header-sticky {position: sticky; top: 0; background-color: #FFFFFF !important; box-shadow: 0 5px 5px -5px #00000040 !important;}

      .hidden, [v-cloak] {display: none;}

      

      
      .progress { height: 3em }
.bg-male { background-color: #0C619D; flex-direction: row; align-items: center }
.bg-female { background-color: #AA5986; flex-direction: row; align-items: center }

.loading-spinner {animation: infinite-rotate 2s linear infinite;}

@keyframes infinite-rotate {
  from { transform: rotate(0deg) }
  to { transform: rotate(360deg) }
}

      

    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light">
  <div class="container">
    <a class="navbar-brand" href="/">
      <svg version="1.1" id="Слой_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 250 50" style="enable-background:new 0 0 250 50;" xml:space="preserve">
      <style type="text/css">
        .st1{fill:#2361FF;}
        .st2{fill:#FF9100;}
      </style>
      <g>
        <path class="st1" d="M69.5,11.2c-1,0.5-1.8,0.6-2.5,0.6c-2.1,0-3.5-0.7-4.5-1.6c-1-1-1.8-2.5-1.8-4.3s0.7-3.3,1.8-4.3
          c1-1,2.5-1.6,4.2-1.6c0.7,0,1.6,0.2,2.7,0.6v3C68.9,3,68,2.4,66.8,2.4c-1,0-1.7,0.3-2.3,0.9c-0.6,0.6-1.1,1.5-1.1,2.6
          c0,1.2,0.5,2,1,2.5c0.2,0.2,1.1,1,2.4,1c0.7,0,1.6-0.2,2.6-1.2L69.5,11.2L69.5,11.2z"/>
        <path class="st1" d="M81.6,1.6c1.1,1,1.8,2.5,1.8,4.3c0,1.5-0.5,3.1-1.8,4.2c-1.1,1-2.5,1.7-4.4,1.7c-2.1,0-3.6-0.8-4.4-1.7
          C71.7,9.2,71,7.6,71,6s0.7-3.3,1.8-4.3C73.5,0.9,74.9,0,77.2,0C79,0,80.5,0.5,81.6,1.6z M74.7,3.4c-0.5,0.5-1,1.3-1,2.6
          c0,1,0.3,1.9,1,2.5c0.7,0.7,1.5,0.9,2.4,0.9c1.2,0,2-0.4,2.5-1c0.4-0.4,1-1.2,1-2.5c0-1.2-0.5-2-1-2.5c-0.6-0.5-1.5-1-2.5-1
          C76.2,2.4,75.3,2.8,74.7,3.4z"/>
        <path class="st1" d="M86.4,0.3l2.9,7.3l2.9-7.3H95l-4.8,11.3h-1.8L83.6,0.3H86.4z"/>
        <path class="st1" d="M98.9,0.3v11.3h-2.6V0.3H98.9z"/>
        <path class="st1" d="M105.1,0.3c1.5,0,3.1,0.2,4.5,1.6c1,1,1.6,2.3,1.6,4.1s-0.6,3.1-1.5,4c-1.6,1.6-3.5,1.7-4.5,1.7h-3.7V0.3
          H105.1z M104.1,9.4h0.7c0.5,0,1.7-0.1,2.6-0.8c0.6-0.5,1.1-1.5,1.1-2.7s-0.5-2-0.9-2.4c-0.9-0.8-2-1-2.8-1h-0.7
          C104.1,2.5,104.1,9.4,104.1,9.4z"/>
        <path class="st1" d="M112.7,4.7h4.4v2.1h-4.4V4.7z"/>
        <path class="st1" d="M121.8,2.5h-1.6V0.3h4.2v11.3h-2.6V2.5z"/>
        <path class="st1" d="M128.6,11.6l3-3.7C131.2,8,130.9,8,130.5,8c-1.2,0-2.2-0.4-2.9-1.1c-0.6-0.6-1-1.5-1-2.7c0-1.7,0.8-2.6,1.1-3
          c1.1-1.2,2.7-1.3,3.6-1.3c1.8,0,2.8,0.6,3.4,1.1c0.6,0.5,1.2,1.5,1.2,2.9c0,0.7-0.2,1.5-0.5,2.3c-0.3,0.6-0.8,1.4-1.3,2.1l-2.6,3.4
          L128.6,11.6z M129.9,2.7c-0.2,0.2-0.6,0.6-0.6,1.4c0,0.7,0.3,1.2,0.6,1.5c0.4,0.3,0.9,0.5,1.4,0.5c0.6,0,1.1-0.2,1.4-0.5
          c0.3-0.3,0.6-0.7,0.6-1.5c0-0.5-0.2-1-0.6-1.4c-0.3-0.3-0.7-0.5-1.4-0.5C130.8,2.1,130.3,2.3,129.9,2.7z"/>
        <path class="st1" d="M147,5.4h5.6v0.1c0,1.4-0.5,3.5-1.8,4.8s-2.7,1.5-4,1.5c-1.4,0-2.8-0.2-4.1-1.6C142,9.5,141,8.1,141,5.9
          c0-1.9,0.7-3.3,1.6-4.3c1.4-1.4,3.1-1.6,4.5-1.6c0.9,0,2.1,0.2,3.2,0.8c0.8,0.5,1.4,1.3,1.8,2l-2.4,1.3c-0.2-0.4-0.6-0.9-1-1.2
          c-0.5-0.4-1.1-0.5-1.7-0.5c-1,0-1.8,0.3-2.3,0.9c-0.6,0.7-1,1.6-1,2.7c0,1.3,0.5,2.1,1,2.6c0.7,0.7,1.4,0.9,2.3,0.9
          c1.1,0,1.7-0.4,2-0.6c0.1-0.1,0.6-0.5,0.8-1.3H147V5.4z"/>
        <path class="st1" d="M157.2,0.3v9.1h3.5v2.2h-6.1V0.3H157.2z"/>
        <path class="st1" d="M171.9,1.6c1.1,1,1.8,2.5,1.8,4.3c0,1.5-0.5,3.1-1.8,4.2c-1.1,1-2.5,1.7-4.4,1.7c-2.1,0-3.6-0.8-4.4-1.7
          c-1.1-1-1.8-2.5-1.8-4.2c0-1.6,0.7-3.3,1.8-4.3c0.8-0.8,2.2-1.7,4.4-1.7C169.3,0,170.8,0.5,171.9,1.6z M165,3.4
          c-0.5,0.5-1,1.3-1,2.6c0,1,0.3,1.9,1,2.5c0.7,0.7,1.5,0.9,2.4,0.9c1.2,0,2-0.4,2.5-1c0.4-0.4,1-1.2,1-2.5c0-1.2-0.5-2-1-2.5
          c-0.6-0.5-1.5-1-2.5-1C166.5,2.4,165.7,2.8,165,3.4z"/>
        <path class="st1" d="M179.1,0.3c0.6,0,2,0,2.9,0.9c0.7,0.7,0.8,1.6,0.8,2.1c0,0.4-0.1,1-0.4,1.4c-0.3,0.5-0.7,0.7-1,0.8
          c0.5,0.1,1.2,0.4,1.6,0.8c0.4,0.4,0.7,1,0.7,2c0,1.1-0.4,1.9-0.9,2.3c-0.9,0.9-2.3,1-3,1h-4.3V0.3H179.1z M178.2,4.9h0.4
          c0.4,0,1-0.1,1.3-0.3c0.2-0.2,0.5-0.5,0.5-1s-0.2-0.8-0.4-1c-0.4-0.3-0.9-0.3-1.4-0.3h-0.4L178.2,4.9L178.2,4.9z M178.2,9.6h0.6
          c0.7,0,1.5,0,1.9-0.5c0.2-0.2,0.4-0.5,0.4-1s-0.2-0.8-0.4-0.9c-0.5-0.4-1.3-0.4-1.9-0.4h-0.7L178.2,9.6L178.2,9.6z"/>
        <path class="st1" d="M192.4,9.5h-4.3l-0.9,2.1h-2.7l4.6-11.3h2.4l4.5,11.3h-2.7L192.4,9.5z M191.7,7.4l-1.4-3.8l-1.4,3.8H191.7z"/>
        <path class="st1" d="M199.9,0.3v9.1h3.5v2.2h-6.1V0.3H199.9z"/>
      </g>
      <g>
        <path class="st1" d="M67.7,18.2h-3.8v2.2h3.6v2.2h-3.6v2.5h3.8v2.2h-6.4V16h6.4C67.7,16,67.7,18.2,67.7,18.2z"/>
        <path class="st1" d="M73.4,16c1.5,0,3.1,0.2,4.5,1.6c1,1,1.6,2.3,1.6,4.1c0,1.8-0.6,3.1-1.5,4c-1.6,1.6-3.5,1.7-4.5,1.7h-3.7V16
          H73.4z M72.4,25.1h0.7c0.5,0,1.7-0.1,2.6-0.8c0.6-0.5,1.1-1.5,1.1-2.7s-0.5-2-0.9-2.4c-0.9-0.8-2-1-2.8-1h-0.7
          C72.4,18.2,72.4,25.1,72.4,25.1z"/>
        <path class="st1" d="M91,22.7c0,1.1-0.1,2.4-1.3,3.6c-1.1,1.1-2.3,1.3-3.5,1.3s-2.4-0.2-3.5-1.3c-1.1-1.2-1.3-2.5-1.3-3.6V16H84
          v6.6c0,0.5,0,1.3,0.6,1.9c0.5,0.5,1.1,0.6,1.6,0.6s1.1-0.1,1.6-0.6c0.6-0.6,0.6-1.4,0.6-1.9V16H91V22.7z"/>
        <path class="st1" d="M101.7,27c-1,0.5-1.8,0.6-2.5,0.6c-2.1,0-3.5-0.7-4.5-1.6c-1-1-1.8-2.5-1.8-4.3s0.7-3.3,1.8-4.3
          c1-1,2.5-1.6,4.2-1.6c0.7,0,1.6,0.2,2.7,0.6v3c-0.6-0.6-1.4-1.2-2.7-1.2c-1,0-1.7,0.3-2.3,0.9c-0.6,0.6-1.1,1.5-1.1,2.6
          c0,1.2,0.5,2,1,2.5c0.2,0.2,1.1,1,2.4,1c0.7,0,1.6-0.2,2.6-1.2v3H101.7z"/>
        <path class="st1" d="M110.5,25.2h-4.3l-0.9,2.1h-2.7l4.6-11.3h2.4l4.5,11.3h-2.7L110.5,25.2z M109.7,23.2l-1.4-3.8l-1.4,3.8H109.7z
          "/>
        <path class="st1" d="M118.6,18.2v9.1H116v-9.1h-2.5V16h7.5v2.2H118.6z"/>
        <path class="st1" d="M125.1,16v11.3h-2.6V16H125.1z"/>
        <path class="st1" d="M137.7,17.4c1.1,1,1.8,2.5,1.8,4.3c0,1.5-0.5,3.1-1.8,4.2c-1.1,1-2.5,1.7-4.4,1.7c-2.1,0-3.6-0.8-4.4-1.7
          c-1.1-1-1.8-2.5-1.8-4.2c0-1.6,0.7-3.3,1.8-4.3c0.8-0.8,2.2-1.7,4.4-1.7C135,15.8,136.5,16.3,137.7,17.4z M130.8,19.1
          c-0.5,0.5-1,1.3-1,2.6c0,1,0.3,1.9,1,2.5c0.7,0.7,1.5,0.9,2.4,0.9c1.2,0,2-0.4,2.5-1c0.4-0.4,1-1.2,1-2.5c0-1.2-0.5-2-1-2.5
          c-0.6-0.5-1.5-1-2.5-1C132.3,18.2,131.4,18.5,130.8,19.1z"/>
        <path class="st1" d="M141.4,27.3V16h2.3l6.2,7.3V16h2.6v11.3h-2.3L144,20v7.3H141.4z"/>
        <path class="st1" d="M162.9,16c1.4,0,2.3,0.5,2.9,1c0.5,0.5,1,1.3,1,2.5c0,0.7-0.2,1.6-0.9,2.3c-0.4,0.4-1,0.7-1.6,0.9l3.5,4.6
          h-3.2l-3.1-4.5v4.5h-2.6V16H162.9z M161.5,21.2h0.6c0.5,0,1.1-0.1,1.6-0.5c0.2-0.2,0.4-0.5,0.4-1.1s-0.3-1-0.5-1.2
          c-0.4-0.3-1.1-0.4-1.4-0.4h-0.6v3.2H161.5z"/>
        <path class="st1" d="M175.6,18.2h-3.8v2.2h3.6v2.2h-3.6v2.5h3.8v2.2h-6.4V16h6.4V18.2z"/>
        <path class="st1" d="M185.9,27c-1,0.5-1.8,0.6-2.5,0.6c-2.1,0-3.5-0.7-4.5-1.6c-1-1-1.8-2.5-1.8-4.3s0.7-3.3,1.8-4.3
          c1-1,2.5-1.6,4.2-1.6c0.7,0,1.6,0.2,2.7,0.6v3c-0.6-0.6-1.4-1.2-2.7-1.2c-1,0-1.7,0.3-2.3,0.9s-1.1,1.5-1.1,2.6c0,1.2,0.5,2,1,2.5
          c0.2,0.2,1.1,1,2.4,1c0.7,0,1.6-0.2,2.6-1.2v3H185.9z"/>
        <path class="st1" d="M198.1,17.4c1.1,1,1.8,2.5,1.8,4.3c0,1.5-0.5,3.1-1.8,4.2c-1.1,1-2.5,1.7-4.4,1.7c-2.1,0-3.6-0.8-4.4-1.7
          c-1.1-1-1.8-2.5-1.8-4.2c0-1.6,0.7-3.3,1.8-4.3c0.8-0.8,2.2-1.7,4.4-1.7C195.4,15.8,196.9,16.3,198.1,17.4z M191.2,19.1
          c-0.5,0.5-1,1.3-1,2.6c0,1,0.3,1.9,1,2.5c0.7,0.7,1.5,0.9,2.4,0.9c1.2,0,2-0.4,2.5-1c0.4-0.4,1-1.2,1-2.5c0-1.2-0.5-2-1-2.5
          c-0.6-0.5-1.5-1-2.5-1C192.7,18.2,191.8,18.5,191.2,19.1z"/>
        <path class="st1" d="M202.9,16l2.9,7.3l2.9-7.3h2.8l-4.8,11.3h-1.8L200,16H202.9z"/>
        <path class="st1" d="M219.1,18.2h-3.8v2.2h3.6v2.2h-3.6v2.5h3.8v2.2h-6.4V16h6.4V18.2z"/>
        <path class="st1" d="M225.2,16c1.4,0,2.3,0.5,2.9,1c0.5,0.5,1,1.3,1,2.5c0,0.7-0.2,1.6-0.9,2.3c-0.4,0.4-1,0.7-1.6,0.9l3.5,4.6
          h-3.2l-3.1-4.5v4.5h-2.6V16H225.2z M223.9,21.2h0.6c0.5,0,1.1-0.1,1.6-0.5c0.2-0.2,0.4-0.5,0.4-1.1s-0.3-1-0.5-1.2
          c-0.4-0.3-1.1-0.4-1.4-0.4H224v3.2H223.9z"/>
        <path class="st1" d="M234,22.1l-4-6.1h3.1l2.3,3.5l2.3-3.5h3.1l-4.1,6.1v5.3H234V22.1z"/>
      </g>
      <g>
        <path class="st1" d="M65.2,34v9.1h-2.6V34h-2.5v-2.2h7.5V34H65.2z"/>
        <path class="st1" d="M73.1,31.8c1.4,0,2.3,0.5,2.9,1c0.5,0.5,1,1.3,1,2.5c0,0.7-0.2,1.6-0.9,2.3c-0.4,0.4-1,0.7-1.6,0.9l3.5,4.6
          h-3.2l-3.1-4.5v4.5h-2.6V31.8H73.1z M71.7,36.9h0.6c0.5,0,1.1-0.1,1.6-0.5c0.2-0.2,0.4-0.5,0.4-1.1s-0.3-1-0.5-1.2
          c-0.4-0.3-1.1-0.4-1.4-0.4h-0.6L71.7,36.9L71.7,36.9z"/>
        <path class="st1" d="M86.2,41H82l-0.9,2.1h-2.7L83,31.8h2.4l4.5,11.3h-2.7L86.2,41z M85.5,39l-1.4-3.8L82.7,39H85.5z"/>
        <path class="st1" d="M98.9,42.7c-1,0.5-1.8,0.6-2.5,0.6c-2.1,0-3.5-0.7-4.5-1.6c-1-1-1.8-2.5-1.8-4.3s0.7-3.3,1.8-4.3
          c1-1,2.5-1.6,4.2-1.6c0.7,0,1.6,0.2,2.7,0.6v3c-0.6-0.6-1.4-1.2-2.7-1.2c-1,0-1.7,0.3-2.3,0.9c-0.6,0.6-1.1,1.5-1.1,2.6
          c0,1.2,0.5,2,1,2.5c0.2,0.2,1.1,1,2.4,1c0.7,0,1.6-0.2,2.6-1.2v3H98.9z"/>
        <path class="st1" d="M103.7,36.5l3.9-4.7h3.2l-4.6,5.4l4.9,6h-3.4l-4.1-5v5H101V31.8h2.6L103.7,36.5L103.7,36.5z"/>
        <path class="st1" d="M118.8,34H115v2.2h3.6v2.2H115v2.5h3.8v2.2h-6.4V31.8h6.4V34z"/>
        <path class="st1" d="M124.9,31.8c1.4,0,2.3,0.5,2.9,1c0.5,0.5,1,1.3,1,2.5c0,0.7-0.2,1.6-0.9,2.3c-0.4,0.4-1,0.7-1.6,0.9l3.5,4.6
          h-3.2l-3.1-4.5v4.5H121V31.8H124.9z M123.6,36.9h0.6c0.5,0,1.1-0.1,1.6-0.5c0.2-0.2,0.4-0.5,0.4-1.1s-0.3-1-0.5-1.2
          c-0.4-0.3-1.1-0.4-1.4-0.4h-0.6L123.6,36.9L123.6,36.9z"/>
      </g>
      <path class="st1" d="M3.2,16.2h14c1.8,0,3.2-1.5,3.2-3.2V3.2C20.5,1.5,19,0,17.2,0h-14C1.5,0,0,1.5,0,3.2V13
        C0,14.7,1.5,16.2,3.2,16.2z M2.4,3.2c0-0.5,0.4-0.8,0.8-0.8h14c0.5,0,0.8,0.4,0.8,0.8V13c0,0.5-0.4,0.8-0.8,0.8h-14
        c-0.5,0-0.8-0.4-0.8-0.8C2.4,13,2.4,3.2,2.4,3.2z"/>
      <path class="st1" d="M26.1,24.5h14c1.8,0,3.2-1.5,3.2-3.2V3.2c0-1.8-1.5-3.2-3.2-3.2h-14c-1.8,0-3.2,1.5-3.2,3.2v18.1
        C22.9,23.1,24.4,24.5,26.1,24.5z M25.3,3.2c0-0.5,0.4-0.8,0.8-0.8h14c0.5,0,0.8,0.4,0.8,0.8v18.1c0,0.5-0.4,0.8-0.8,0.8h-14
        c-0.5,0-0.8-0.4-0.8-0.8V3.2z"/>
      <path class="st2" d="M38.3,43.4L37.8,41H26.1c-0.5,0-0.8-0.4-0.8-0.8v-9.7c0-0.5,0.4-0.8,0.8-0.8h14c0.5,0,0.8,0.4,0.8,0.8v5.9
        l2.4,1.4v-7.3c0-1.8-1.5-3.2-3.2-3.2h-14c-1.8,0-3.2,1.5-3.2,3.2v9.7c0,1.8,1.5,3.2,3.2,3.2C26.1,43.4,38.3,43.4,38.3,43.4z"/>
      <path class="st1" d="M3.2,43.4h14c1.8,0,3.2-1.5,3.2-3.2V22.1c0-1.8-1.5-3.2-3.2-3.2h-14c-1.8,0-3.2,1.5-3.2,3.2v18.1
        C0,41.9,1.5,43.4,3.2,43.4z M2.4,22.1c0-0.5,0.4-0.8,0.8-0.8h14c0.5,0,0.8,0.4,0.8,0.8v18.1c0,0.5-0.4,0.8-0.8,0.8h-14
        c-0.5,0-0.8-0.4-0.8-0.8C2.4,40.2,2.4,22.1,2.4,22.1z"/>
      <path class="st1" d="M41,36.3l-3.1-1.8c-0.5-0.3-1.2,0.2-1.1,0.8l1.1,5.8l0.5,2.4l1.1,6c0.1,0.7,1,0.8,1.3,0.2l3.1-5.5l6.2-1
        c0.7-0.1,0.9-1,0.3-1.4l-6.9-4L41,36.3z"/>
      </svg>
   
    
      <!-- <svg class="d-inline-block align-text-top" version="1.1" xmlns="http://www.w3.org/2000/svg"	xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 300 296.3" style="enable-background:new 0 0 300 296.3;" xml:space="preserve">
        <style type="text/css">
          .st0 {fill:#2361FF;}
          .st1 {fill:#FF9100;}
        </style>
        <g>
          <path class="st0" d="M19.2,96H102c10.6,0,19.2-8.6,19.2-19.2V19.2C121.2,8.6,112.6,0,102,0H19.2C8.6,0,0,8.6,0,19.2v57.6 C0,87.4,8.6,96,19.2,96z M14.2,19.2c0-2.8,2.3-5,5-5H102c2.8,0,5,2.3,5,5v57.6c0,2.8-2.3,5-5,5H19.2c-2.8,0-5-2.3-5-5V19.2z"/>
          <path class="st0" d="M154.9,145.4h82.8c10.6,0,19.2-8.6,19.2-19.2v-107c0-10.6-8.6-19.2-19.2-19.2h-82.8 c-10.6,0-19.2,8.6-19.2,19.2v107C135.7,136.8,144.3,145.4,154.9,145.4z M149.9,19.2c0-2.8,2.3-5,5-5h82.8c2.8,0,5,2.3,5,5v107 c0,2.8-2.3,5-5,5h-82.8c-2.8,0-5-2.3-5-5V19.2z"/>
          <path class="st1" d="M226.7,256.9l-2.7-14.2h-69.1c-2.8,0-5-2.3-5-5v-57.6c0-2.8,2.3-5,5-5h82.8c2.8,0,5,2.3,5,5v34.9l14.2,8.3	v-43.2c0-10.6-8.6-19.2-19.2-19.2h-82.8c-10.6,0-19.2,8.6-19.2,19.2v57.6c0,10.6,8.6,19.2,19.2,19.2H226.7z"/>
          <path class="st0" d="M19.2,256.9H102c10.6,0,19.2-8.6,19.2-19.2v-107c0-10.6-8.6-19.2-19.2-19.2H19.2C8.6,111.5,0,120.2,0,130.7 v107C0,248.3,8.6,256.9,19.2,256.9z M14.2,130.7c0-2.8,2.3-5,5-5H102c2.8,0,5,2.3,5,5v107c0,2.8-2.3,5-5,5H19.2c-2.8,0-5-2.3-5-5 V130.7z"/>
          <path class="st0" d="M242.8,215.1l-18.5-10.8c-3.2-1.8-7.3,0.9-6.8,4.5l6.4,34.1l2.7,14.2l6.8,35.7c0.5,4.1,5.9,4.5,7.7,1.4 l18.2-32.7l36.8-5.9c4.1-0.5,5.5-5.9,1.8-8.2l-40.9-24L242.8,215.1z"/>
        </g>
      </svg> -->
      <!-- <div class="d-inline-block">
      </div> -->
    </a>  
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav w-100 ms-5 mb-2 mb-lg-0 justify-content-between">
        
        <li class="nav-item">
          <a class="btn btn-outline-primary" href="/contact/">Subscribe / Contact</a>
        </li>        
        <li class="nav-item">
          <a class="nav-link" href="/stories/">Stories</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/visualizations/">Visualizations</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navBarAboutDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            About
          </a>
          <ul class="dropdown-menu" aria-labelledby="navBarAboutDropdown">
            <li><a class="dropdown-item" href="/about/">Partnership</a></li>
            <li><a class="dropdown-item" href="/about/#disclaimer">Disclaimer</a></li>
            <li><a class="dropdown-item border-bottom mb-2" href="/methodology/">Methodology</a></li>
            <li><a class="dropdown-item" href="/data/">Get Data</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>
<div class="container-fluid alert bg-danger text-white text-center fs-4">
  <strong>
    <i class="fa fa-exclamation-circle me-2"></i>As of 11 February 2022, we have paused updates to this site until further notice.
  </strong>
</div>

    
    <div class="spacer-5"></div>

<div id="vue-app" class="container" v-cloak>
  <template v-if="errorMessage">
    <div class="w-100 d-flex flex-column justify-content-center align-items-start">
      <h4>We encountered an error while loading this page.</h4>
      <span class="text-muted">${ errorMessage }</span>
    </div>
  </template>
  <template v-else-if="countries.length > 0">
    <h2>In-person education status & COVID-19 case rates</h2>
    <div class="row">
        <div class="flex-fill my-2 mx-2">
          <div class="form-floating">
            <select class="form-select" id="region-select" v-model="selectedRegion">
              <option v-for="region in displayedRegions" :value="region">${ region.label }</option>
            </select>
            <label for="region-select">Select a region</label>
          </div>
        </div>
        <div class="flex-fill my-2 mx-2">
          <div class="form-floating">
            <select class="form-select" id="country-select" v-model="selectedCountry">
              <option v-for="country in displayedCountries" :value="country">${ country.countryName }</option>
            </select>
            <label for="country-select">Select a country / territory</label>
          </div>  
        </div>
        
    </div>
    <div class="row">
      <svg id="chart" xmlns="http://www.w3.org/2000/svg" version="1.1"></svg>
      <svg height="10" width="10" xmlns="http://www.w3.org/2000/svg" version="1.1">
      </svg> 
    </div>
    <div class="row mt-5">
      <h2>About this graph</h2>
      <p>
        The GERT survey asks respondents to indicate in-person learning by percentage ranges. Dates in this graph are approximate. GERT collects data in two-week rounds (with a few being slightly shorter or longer). Information about a country can arrive at any point within the round. When we display values by date on these graphs, we draw them beginning at the end date of the round, and they remain in effect until the subsequent round's end date.
      <p>
        For graphing purposes we plot the midpoint of the respondent's range selection:
      </p>
      <table class="table">
        <thead>
          <tr>
            <th scope="col">Survey response</th>
            <th scope="col">Graphed value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td scope="row">90-100%</td>
            <td>~95%</td>
          </tr>
          <tr>
            <td scope="row">50-90%</td>
            <td>~70%</td>
          </tr>
          <tr>
            <td scope="row">10-50%</td>
            <td>~30%</td>
          </tr>
          <tr>
            <td scope="row">0-10%</td>
            <td>~5%</td>
          </tr>
          <tr>
            <td scope="row">Unknown</td>
            <td>Not graphed</td>
          </tr>
          <tr>
            <td scope="row">Not applicable</td>
            <td>Not graphed</td>
          </tr>
        </tbody>
      </table>
      <h2>Additional data sources</h2>
      <ul>
        <li>
          <a href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data/csse_covid_19_time_series">JHU CSSE COVID-19 Time Series</a>
        </li>
        <li>
          <a href="https://github.com/CSSEGISandData/COVID-19/blob/master/csse_covid_19_data/UID_ISO_FIPS_LookUp_Table.csv">JHU CSSE Lookup Table</a>
        </li>
      </ul>
    </div>

    <div class="container">
      To cite this work, use the following: Johns Hopkins University, World Bank & UNICEF (2021). COVID-19 Global
      Education Recovery Tracker. Baltimore, Washington DC, New York: JHU, World Bank, UNICEF.
    </div>
    <div class="spacer-10"></div>

    

  </template>
  <template v-else>
    <h2>Loading <span class="loading-spinner"><i class="fas fa-spinner loading-spinner"></i></span></h2>
  </template>
</div>

<div class="spacer-10"></div>

<script>
const vm = new Vue({
  el: '#vue-app',
  data() {
    return {
      countries: [],
      covidDataCountryCodes: [],
      covidDataTimeSeries: [],
      covidLastUpdated: undefined,
      errorMessage: undefined,
      // this structure defines the various grade levels and the variable names for the fields which are broken out by grade level
      // if a variable doesn't include a grade level, it is left undefined (e.g. in-person academic supports [ipasKey] isn't collected for higher or vocational)
      gradeLevelList: [
        { label: 'Pre-Primary', mresKey: 'educationStatusPrePrimaryCode', ipasKey: 'mostRecentInPersonAdditionalSupportPrePrimary', mrremKey: 'mostRecentRemoteEducationModalitiesPrePrimaryCode' },
        { label: 'Primary', mresKey: 'educationStatusPrimaryCode', ipasKey: 'mostRecentInPersonAdditionalSupportPrimary', mrremKey: 'mostRecentRemoteEducationModalitiesPrimaryCode' },
        { label: 'Lower Secondary', mresKey: 'educationStatusLowerSecondaryCode', ipasKey: 'mostRecentInPersonAdditionalSupportLowerSecondary', mrremKey: 'mostRecentRemoteEducationModalitiesLowerSecondaryCode' },
        { label: 'Upper Secondary', mresKey: 'educationStatusUpperSecondaryCode', ipasKey: 'mostRecentInPersonAdditionalSupportUpperSecondary', mrremKey: 'mostRecentRemoteEducationModalitiesUpperSecondaryCode' },
        { label: 'Higher Education', mresKey: 'educationStatusHigherCode', ipasKey: undefined, mrremKey: 'mostRecentRemoteEducationModalitiesHigherCode' },
        { label: 'Technical/vocational', mresKey: 'educationStatusVocationalCode', ipasKey: undefined, mrremKey: 'mostRecentRemoteEducationModalitiesVocationalCode' }
      ],
      regions: [
        { id: 'global', label: 'All', countries: [] }
      ],
      responseRounds: [],
      selectedCountry: undefined,
      selectedRegion: undefined,
      svgSettings: {
        width: 1920,
        height: 900,
        initialized: false,
        topGraph: { x1: 200, y1: 75, x2: 1820, y2: 350, 
          background: { group: 'top-graph-background', fill: '#F8F8F8' }
        },
        bottomGraph: { x1: 200, y1: 410, x2: 1820, y2: 735,
          background: {group: 'bottom-graph-background', fill: '#F8F8F8' }
        },
        covidDailyCasesDomain: [0.001, 0],
        strokeWidth: '10px',
        educationStatusValues: [
          { id: 0, color: '#DDFF00', predictedColor: 'url(#diagonal-stripe-4) #DDFF00A0', label: 'Extended Break', rowIndex: 1 },
          { id: 1, color: '#C7A7FF', predictedColor: 'url(#diagonal-stripe-4) #C7A7FFA0', label: 'COVID Closure', rowIndex: 0 },
          { id: 2, color: '#4FFFCD', predictedColor: 'url(#diagonal-stripe-4) #4FFFCDA0', label: 'Remote', rowIndex: 2 },
          { id: 3, color: '#26B1FF', predictedColor: 'url(#diagonal-stripe-4) #26B1FFA0', label: 'Hybrid', rowIndex: 3 },
          { id: 4, color: '#1A49BF', predictedColor: 'url(#diagonal-stripe-4) #1A49BFA0', label: 'In-person', rowIndex: 4 },
          { id: 5, color: '#00000010', predictedColor: 'url(#diagonal-stripe-4) #00000010', label: 'Unknown/NA' }
        ],
        gradeLevelColors: {
          prePrimary: { color: 'red', predictedColor: '#FF0000A0' },
          primary: { color: 'orange', predictedColor: '#FFA500A0' },
          lowerSecondary: { color: 'yellow', predictedColor: '#FFFF00A0' },
          upperSecondary: { color: 'green', predictedColor: '#00FF00A0' },
          higher: { color: 'blue', predictedColor: '#0000FFA0' },
          vocational: { color: 'purple', predictedColor: '#800080A0' }
        },
        inPersonCoverageResponseValues: {
          '1': { label: '91-100%', graphValue: 0.95 },
          '2': { label: '51-90%', graphValue: 0.70 },
          '3': { label: '11-50%', graphValue: 0.30 },
          '4': { label: '0-10%', graphValue: 0.5 },
          '5': { label: 'Not applicable'},
          '6': { label: 'Unknown'},
        },
        graphBackgroundValues: [
          { label: 'Total cases (actual)', key: 'totalCases', formatCode: '~s' },
          { label: 'Total cases (7-day moving average)', key: 'rollingTotalCases', formatCode: '~s' },
          { label: 'Total cases per capita (actual)', key: 'totalCasesPerCapita', formatCode: '~%' },
          { label: 'Total cases per capita (7-day moving average)', key: 'rollingTotalCasesPerCapita', formatCode: '~%' },
          { label: 'Daily new cases (actual)', key: 'newCases', formatCode: '~s' },
          { label: 'Daily new cases (7-day moving average)', key: 'rollingNewCases', formatCode: '~s' },
          { label: 'Daily new cases per capita (actual)', key: 'newCasesPerCapita', formatCode: '~%' },
          { label: 'Daily new cases per capita (7-day moving average)', key: 'rollingNewCasesPerCapita', formatCode: '~%' }
        ]
      },
      urls: {
        covidDataCountryCodes: 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/UID_ISO_FIPS_LookUp_Table.csv',
        covidDataTimeSeries: 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv',
        global: '/data/global.v2.min.json'
      }
    }
  },
  delimiters: ['${', '}'],  // need to use these because jekyll competes for 
  filters: {
    iso8601ToLocaleDateString: (value) => {
      if (value) {
        return (new Date(value)).toLocaleDateString(undefined, { timeZone: 'UTC' });
      } else {
        return null
      }
    },
    friendlyDate: function (value) {
      try {
        date = new Date.parse(value)
        return date
          .setHours(0)
          .setMinutes(0)
          .setSeconds(0)
          .setMilliseconds(0)
          .toLocaleString()
      } catch {
        return 'unknown'
      }
    },
    friendlyNumber: function (value) {
      try {
        return value.toLocaleString()
      } catch (err) {
        return 'unknown'
      }
    }
  },
  async mounted() {
    const startTime = Date.now()
    // newer, slicker data loading
    const downloadedData = await Promise.allSettled([
      await fetch(this.urls.global)
        .then((response) => { if (response.ok) { return response.json() } })
        .catch(err => console.error(err)),
      await d3.csv(this.urls.covidDataCountryCodes)
        .catch(err => console.warn('non-fatal error loading country lookup table \n', err)),
      await d3.csv(this.urls.covidDataTimeSeries)
        .catch(err => console.warn('non-fatal error loading covid timeseries data \n', err)),
    ]).then(([globalDataResponse, covidDataCountryCodes, covidDataTimeSeries]) => {
      return {
        global: globalDataResponse.value,
        covidDataCountryCodes: covidDataCountryCodes.value,
        covidDataTimeSeries: covidDataTimeSeries.value
      }
    })

    console.log(downloadedData)
    console.log(`data loaded in ${Date.now() - startTime} ms`)

    if (!downloadedData.global) {
      // if we don't have the core data, we can't do anything
      this.errorMessage = 'Error loading core data'
    } else {
      // otherwise, process the data sources (including non-core data if available)

      // by pushing the data instead of replacing the arrays, vue will correctly bind reactivity
      this.responseRounds.push(...downloadedData.global.responseRounds)
      console.log(`loaded ${this.responseRounds.length} response rounds at ${Date.now() - startTime} ms`)
      this.countries.push(...this.processCountries(downloadedData.global.countries))
      console.log(`loaded ${this.countries.length} countries at ${Date.now() - startTime} ms`)
      this.regions[0].countries.push(...this.countries)
      console.log(`loaded ${this.regions[0].countries.length} countries into region 0 at ${Date.now() - startTime} ms`)
      this.regions.push(...this.processRegions(downloadedData.global.countries))
      console.log(`loaded ${this.regions.length} regions at ${Date.now() - startTime} ms`)

      if (downloadedData.covidDataCountryCodes) {
        this.covidDataCountryCodes.push(...downloadedData.covidDataCountryCodes)
        console.log(`loaded ${this.covidDataCountryCodes.length} covid data country codes at ${Date.now() - startTime} ms`)
      }

      if (downloadedData.covidDataTimeSeries) {
        this.covidDataTimeSeries.push(...downloadedData.covidDataTimeSeries)
        console.log(`loaded ${this.covidDataTimeSeries.length} covid data time series at ${Date.now() - startTime} ms`)
      }
    }

    this.selectedRegion = this.regions[0]
    this.selectedCountry = this.countries[211]

    console.log(`mounted in ${Date.now() - startTime} ms`)
  },
  updated() {
    const startTime = Date.now()

    if (!this.svgSettings.initialized) {
      this.initializeGraph()
      this.svgSettings.initialized = true
    }
    this.updateGraph()

    // tippy needs to initialize after DOM is rendered. Normally this would be mounted() but
    // since data is loaded asynchronously, mounted() will be called before the data has been loaded.
    // tippy('[popover]', {
    //   placement: 'top',
    //   maxWidth: 350,
    //   allowHTML: true,
    //   onShow(instance) {
    //     instance.setContent(instance.reference.attributes.popover.value);
    //   }
    // })

    console.log(`updated in ${Date.now() - startTime} ms`)
  },
  computed: {
    // access this computed property to render the data, it applies the rules set by this.filter
    displayedCountries() {
      return this.selectedRegion.countries
    },
    displayedCountryGraphData() {
      const startTime = Date.now()
      const displayedCountryGraphData = this.selectedCountry
        ? { 
          covidCasesPath: this.getCovidCasesPath(this.selectedCountryDailyRollingNewCases, this.svgProperties.bottomGraph),
          inPersonPercentagePoints: [],
          inPersonPercentageLines: this.getInPersonPercentageLines(this.displayedResponseRoundsWithResponses, this.svgProperties.bottomGraph),
          educationStatusRectangles: this.getEducationStatusRectangles(this.displayedResponseRoundsWithResponses, this.svgProperties.educationStatusValues, this.svgProperties.topGraph),
        }
        : {
          covidCasesPath: [],
          inPersonPercentagePoints: [],
          inPersonPercentageLines: [],
          educationStatusRectangles: [],
        }
      console.log(`computed displayedCountryGraphData in ${Date.now() - startTime} ms`)
      return displayedCountryGraphData
    },
    displayedRegions() {
      return this.regions
    },
    displayedResponseRounds() {
      const startTime = Date.now()
      const displayedResponseRounds = Array
        .from(new Set(this.countries
          .flatMap(c => c.responsesPublic || [])
          .map(r => r.roundId)
        ))
        .map(rid => {
          const rr = {...this.responseRounds.find(rr => rr.roundNumber === rid)}
          rr.startDate = new Date(rr.startDate)
          rr.endDate = new Date(rr.endDate)
          return rr
          // return {...this.responseRounds.find(rr => rr.roundNumber === rid)}
        })
        .sort((a,b) => a.roundNumber - b.roundNumber)
      console.log(`computed displayedResponseRounds in ${Date.now() - startTime} ms`)
      return displayedResponseRounds
    },
    displayedResponseRoundsRange() {
      const startTime = Date.now()
      const displayedResponseRoundsRange = [
        d3.min(this.displayedResponseRounds, d => new Date(d.startDate)),
        d3.max(this.displayedResponseRounds, d => new Date(d.endDate))
      ]
      console.log(`computed displayedResponseRoundsRange in ${Date.now() - startTime} ms`)
      return displayedResponseRoundsRange
    },
    displayedResponseRoundsWithResponses() {
      const startTime = Date.now()
      const displayedResponseRoundsWithResponses = this.displayedResponseRounds
        .map(rr => {
          const startX = this.svgProperties.topGraph.xAxis.scale(rr.startDate)
          const endX = this.svgProperties.topGraph.xAxis.scale(d3.timeDay.offset(rr.endDate, 1))
          const midX = startX + ((endX - startX) / 2)
          const responses = (this.selectedCountry.responsesPublic || []).filter(rp => rp.roundId === rr.roundNumber)
          const displayedResponse = responses.slice(-1).pop()
          return {
            ...rr,
            responses,
            isReal: !!displayedResponse,
            displayedResponse,
            startX,
            midX,
            endX,
          }
        })

      // if there's no displayedResponse for the first round, find the first available one and use that value
      if (displayedResponseRoundsWithResponses.length > 0) {
        if (!displayedResponseRoundsWithResponses[0].isReal) {
          const firstRealIndex = displayedResponseRoundsWithResponses.findIndex(d => d.isReal)
          if (firstRealIndex > 0) {
            displayedResponseRoundsWithResponses[0].displayedResponse = displayedResponseRoundsWithResponses[firstRealIndex].displayedResponse
          }
        }

        // iterate through the rest of the displayedResponses and copy the previous one if the response is missing
        if (displayedResponseRoundsWithResponses.length > 1) {
          for (let i = 1; i < displayedResponseRoundsWithResponses.length; i++) {
            if (!displayedResponseRoundsWithResponses[i].isReal) {
              displayedResponseRoundsWithResponses[i].displayedResponse = displayedResponseRoundsWithResponses[i - 1].displayedResponse
            }
          }
        }
      }


      console.log(displayedResponseRoundsWithResponses)
      console.log(`computed displayedResponseRoundsWithResponses in ${Date.now() - startTime} ms`)
      return displayedResponseRoundsWithResponses
    },
    mostRecentResponseDate() {
      const startTime = Date.now()
      const mostRecentResponseDate = d3.max(this.countries
        .flatMap(c => (c.responsesPublic || []).map(r => r.responseDate))
      )
      console.log(`computed mostRecentResponseDate in ${Date.now() - startTime} ms`)
      return mostRecentResponseDate
    },
    selectedCountryDailyRollingNewCases ()  {
      const startTime = Date.now()
      // HUGE performance boost using a local copy rather than referring repeatedly to the computed property
      const scccts = this.selectedCountryCovidCasesTimeSeries
      try {
        const selectedCountryPopulation = scccts.population || 1
        const dailyCases = []
        let previousDayTotal = 0
        for (const propName of Object.getOwnPropertyNames(scccts)) {
          if (propName !== 'iso3' || propName !== 'population') {
            const currentDate = new Date(propName)
            const last7Days = dailyCases.slice(-7)
            const newCases = scccts[propName] - previousDayTotal
            const rollingNewCases = Math.max(last7Days.reduce((sum, v) => sum + v.newCases, 0) / 7, 0)
            dailyCases.push({ 
              date: currentDate, 
              newCases: newCases,
              value: rollingNewCases / selectedCountryPopulation,
              // value2: Math.max(d3.mean(dailyCases.slice(-7), d => d.value2), 0)
            })
            previousDayTotal = scccts[propName]
          }
        }
        // return dailyCases
        const startDate = this.displayedResponseRoundsRange[0].getTime()
        const endDate = this.displayedResponseRoundsRange[1].getTime()

        const selectedCountryDailyRollingNewCases = dailyCases.filter(d => d.date.getTime() >= startDate && d.date.getTime() <= endDate)

        console.log(`computed selectedCountryDailyRollingNewCases in ${Date.now() - startTime} ms`)

        return selectedCountryDailyRollingNewCases
        // return dailyCases.filter(dc => {
        //   const dcDate = dc.date.getTime()
        //   return dcDate >= startDate && dcDate <= endDate
        // })
      } catch (err) {
        console.error(err)
        console.log(`selectedCountryDailyRollingNewCases in ${Date.now() - startTime} ms`)
        return []
      }
    },
    selectedCountryCovidCasesTimeSeries () {
    const startTime = Date.now()
    try {
      const selectedCountryCovidCasesTimeSeries = this.selectedCountryCovidDataCountryInfo
        ? this.covidDataTimeSeries
            .filter(c => c['Country/Region'] === this.selectedCountryCovidDataCountryInfo.Country_Region)
            .reduce((acc, r) => {
              acc.iso3 = this.selectedCountryCovidDataCountryInfo.iso3
              acc.population = this.selectedCountryCovidDataCountryInfo.Population
              for (const propName of Object.getOwnPropertyNames(r)) {
                switch (propName) {
                  case 'Province/State':
                  case 'Country/Region':
                  case 'Lat':
                  case 'Long':
                    break
                  default:
                    if (acc[propName]) {
                      acc[propName] = acc[propName] + Number.parseInt(r[propName])
                    } else {
                      acc[propName] = Number.parseInt(r[propName])
                    }
                }
              }
              return acc
            }, {})
        : {}
      console.log(`computed selectedCountryCovidCasesTimeSeries in ${Date.now() - startTime} ms`)
      return selectedCountryCovidCasesTimeSeries
    } catch (e) {
      console.error(e)
      return {}
    }
    },
    selectedCountryCovidDataCountryInfo () {
      const startTime = Date.now()
      const selectedCountryCovidDataCountryInfo = this.selectedCountry
        ? this.covidDataCountryCodes.find(cc => this.selectedCountry.iso3166Alpha3Code === cc.iso3)
        : undefined
      console.log(`computed selectedCountryCovidDataCountryInfo in ${Date.now() - startTime} ms`)
      return selectedCountryCovidDataCountryInfo
    },
    svgProperties() {
    const startTime = Date.now()
    try {
      // clone the svgSettings from the data
      const svgProperties = {...this.svgSettings, educationStatusValues: {} }

      // the order of these affect z-order
      svgProperties.groups = [
        'graph-labels',
        'top-graph-y-labels',
        'top-graph-background',
        'top-graph-data',
        'bottom-graph-background',
        'bottom-graph-covid',
        'bottom-graph-data-lines',
        'bottom-graph-data-points',
        'bottom-graph-data-key',
        'bottom-graph-yl-axis',
        'bottom-graph-yr-axis',
        'top-graph-x-axis',
        'bottom-graph-x-axis',
      ]

      // set label positions for the education status values
      const esvs = this.svgSettings.educationStatusValues.filter(esv => esv.rowIndex !== undefined)
      const yHeight = (svgProperties.topGraph.y2 - svgProperties.topGraph.y1) / esvs.length

      // set up properties for top graphs
      svgProperties.topGraph.xAxis = {
        group: 'top-graph-x-axis',
        scale: d3.scaleTime()
          .domain(this.displayedResponseRoundsRange)
          .rangeRound([svgProperties.topGraph.x1, svgProperties.topGraph.x2])
          .clamp(true),
        transform: `translate(0,${svgProperties.topGraph.y2})`
      }
      
      svgProperties.topGraph.yAxis = {
        scale: d3.scaleBand()
          .domain(esvs.map((esv, index) => index)
            // Object.getOwnPropertyNames(svgProperties.educationStatusValues)
              // .map(esvName => svgProperties.educationStatusValues[esvName])
              // .filter(esv => esv.rowIndex !== undefined)
              // .sort((a,b) => b.rowIndex - a.rowIndex)
          )
          .range([
            svgProperties.topGraph.y2,
            svgProperties.topGraph.y1
          ])
          .paddingInner(0.05)
      }
      esvs.forEach(v => {
        svgProperties.educationStatusValues[v.id.toString()] = {
          ...v,
          x: svgProperties.topGraph.x1 - 10,
          y: svgProperties.topGraph.y2 - 20 - (yHeight * v.rowIndex),
          startY: svgProperties.topGraph.yAxis.scale(v.rowIndex),
          endY: svgProperties.topGraph.yAxis.scale(v.rowIndex) - svgProperties.topGraph.yAxis.scale.bandwidth()
        }
      })

      svgProperties.topGraph.yLAxis = {
        group: 'top-graph-y-labels',
        transform: `translate (${svgProperties.topGraph.x1}, 0)`
      }
      svgProperties.topGraph.yRAxis = {
        group: 'top-graph-y-labels',
        transform: `translate(${svgProperties.topGraph.x2}, 0)`
      }

      // set up properties for bottom graphs
      svgProperties.bottomGraph.xAxis = {
        group: 'bottom-graph-x-axis',
        scale: svgProperties.topGraph.xAxis.scale,
        transform: `translate(0,${svgProperties.bottomGraph.y1})`
      }
      svgProperties.bottomGraph.yLAxis = {
        group: 'bottom-graph-yl-axis',
        scale: d3.scaleLinear()
          .domain([1,0])
          .range([svgProperties.bottomGraph.y1, svgProperties.bottomGraph.y2])
          .clamp(true),
        tickValues: [0, 0.1, 0.5, 0.9, 1.0],
        transform: `translate(${svgProperties.bottomGraph.x1}, 0)`,
        keys: [
          {
            field: 'inPersonLearningCoveragePrimaryCode',
            colors: svgProperties.gradeLevelColors.primary,
            label: 'Primary',
            values: svgProperties.inPersonCoverageResponseValues,
            yOffset: 10,
            labelX: svgProperties.bottomGraph.x1 - 50,
            labelY: svgProperties.bottomGraph.y2 + 140
          },
          {
            field: 'inPersonLearningCoverageLowerSecondaryCode',
            colors: svgProperties.gradeLevelColors.lowerSecondary,
            label: 'Lower Secondary',
            values: svgProperties.inPersonCoverageResponseValues,
            yOffset: 0,
            labelX: svgProperties.bottomGraph.x1 - 50,
            labelY: svgProperties.bottomGraph.y2 + 110
          },
          {
            field: 'inPersonLearningCoverageUpperSecondaryCode',
            colors: svgProperties.gradeLevelColors.upperSecondary,
            label: 'Upper Secondary',
            values: svgProperties.inPersonCoverageResponseValues,
            yOffset: -10,
            labelX: svgProperties.bottomGraph.x1 - 50,
            labelY: svgProperties.bottomGraph.y2 + 80
          }
        ]
      }
      svgProperties.bottomGraph.yRAxis = {
        group: 'bottom-graph-yr-axis',
        scale: d3.scaleLinear()
          .domain(svgProperties.covidDailyCasesDomain)
          .range([svgProperties.bottomGraph.y1, svgProperties.bottomGraph.y2])
          .clamp(true),
        transform: `translate(${svgProperties.bottomGraph.x2}, 0)`
      }

      svgProperties.mainGraphLabels = [
        {
          label: 'Education Status History (Primary, Lower Secondary, and Upper Secondary)',
          x: svgProperties.width / 2,
          y: 50,
          textAnchor: 'middle',
        },
        {
          label: 'Approximate percentage of in-person learning',
          x: svgProperties.bottomGraph.x1 - 80,
          y: svgProperties.bottomGraph.y2 + 45,
          textAnchor: 'start',
        },
        {
          label: 'COVID Daily new cases per capita (7-day moving average)',
          x: svgProperties.bottomGraph.x2 + 80,
          y: svgProperties.bottomGraph.y2 + 45,
          textAnchor: 'end',
        }
      ]


      console.log(`computed svgProperties in ${Date.now() - startTime} ms`)
      return svgProperties
    } catch (err) {
      console.error(err)
      console.log(`computed svgProperties in ${Date.now() - startTime} ms`)
    }
    }
  },
  methods: {
    getCovidCasesPath (data, graph) {
      const startTime = Date.now()

      const covidArea = d3.area()
        .x(d => graph.xAxis.scale(d.date))
        .y1(d => graph.yRAxis.scale(d.value))
        .y0(graph.yRAxis.scale(0))
      const covidCasesPath = covidArea(data)

      console.log(`method covidCasesPath in ${Date.now() - startTime} ms`)
      return covidCasesPath
    },
    getEducationStatusRectangles (data, educationStatusValues, graph) {
      const startTime = Date.now()

      const rowHeight = graph.yAxis.scale.bandwidth()
      const educationStatusRectangles = []
      data.forEach(rr => {
        if (rr.displayedResponse) {
          if (rr.displayedResponse.extendedBreakCode === '1') {
            educationStatusRectangles.push({
              x: rr.startX,
              y: graph.yAxis.scale(1),
              width: rr.endX - rr.startX,
              height: rowHeight,
              fill: rr.isReal ? educationStatusValues[0].color : educationStatusValues[0].predictedColor
            })
          } else {
            (rr.displayedResponse.educationStatusCode || []).forEach(esc => {
              const esv = educationStatusValues[esc]
              if (esv) {
                educationStatusRectangles.push({
                  x: rr.startX,
                  y: graph.yAxis.scale(esv.rowIndex),
                  width: rr.endX - rr.startX,
                  height: rowHeight,
                  fill: rr.isReal ? esv.color : esv.predictedColor
                })
              }
            })
          }
        }
      })

      console.log(`method educationStatusRectangles in ${Date.now() - startTime} ms`)
      return educationStatusRectangles
    },
    getInPersonPercentageLines (data, graph) {
      const startTime = Date.now()
      const inPersonPercentageLines = {
        points: [],
        lines:[]
      }
      graph.yLAxis.keys.forEach(key => {
        const linePointInfo = []
        data.forEach(rr => {
          if (rr.displayedResponse) {
            const value = rr.displayedResponse[key.field]
            if (value) {
              const responseValue = key.values[value]
              if (responseValue && responseValue.graphValue) {
                linePointInfo.push({
                  startX: rr.startX,
                  midX: rr.midX,
                  endX: rr.endX,
                  isReal: rr.isReal,
                  roundId: rr.roundNumber,
                  y: graph.yLAxis.scale(responseValue.graphValue)+ key.yOffset,
                  stroke: key.colors,
                  strokeWidth: 2
                })
              }              
            }
          }
        })
        console.debug(linePointInfo)
        const lines = [], tempPoints = []
        linePointInfo.forEach((lpi, index) => {
          const nextLpi = linePointInfo[index + 1]
          if (nextLpi) {
            if (lpi.isReal !== nextLpi.isReal) {
              tempPoints.push(lpi)
              lines.push(tempPoints.slice())
              tempPoints.length = 0
            } else {
              tempPoints.push(lpi)
            }
          } else {
            tempPoints.push(lpi)
            lines.push(tempPoints.slice())
            tempPoints.length = 0
          }
        })
        inPersonPercentageLines.points.push(lines)
      })

      const lineRenderer = d3.line().curve(d3.curveMonotoneX)
      inPersonPercentageLines.points.forEach(lineSet => {
        lineSet.forEach(line => {
          const path = lineRenderer(line.map(point => [point.midX, point.y]))
          inPersonPercentageLines.lines.push({
            path,
            stroke: line[0].isReal ? line[0].stroke.color : line[0].stroke.predictedColor,
          })
        })
      })
      console.log(`method inPersonPercentageLines in ${Date.now() - startTime} ms`)
      return inPersonPercentageLines
    },
    drawCovidCases(selection, path) {
      selection.selectAll('path')
        .data([this.displayedCountryGraphData.covidCasesPath])
        .join('path')
          .attr('d', d => d)
          .style('fill', '#00000030')
          .style('stroke','#FFFFFFFF')    
    },
    drawEducationStatusRectangles (selection, rectangles) {
      selection.selectAll('rect')
        .data(rectangles)
        .join('rect')
          .attr('x', d => d.x)
          .attr('y', d => d.y)
          .attr('width', d => d.width)
          .attr('height', d => d.height)
          .style('fill', d => d.fill)
    },
    drawInPersonPercentageLines (selection, lines) {
      const sw = this.svgSettings.strokeWidth
      selection.selectAll('path')
        .data(lines)
        .join('path')
          .attr('d', d => d.path)
          .style('stroke', d => d.stroke)
          .style('stroke-width', sw)
          .style('fill', 'none')
    },
    drawGraphBackgrounds(svg, graphs) {
      graphs.forEach(graph => {
        svg.select(`#${graph.background.group}`)
          .selectAll('rect')
          .data([undefined])
          .join('rect')
            .attr('x', graph.x1)
            .attr('y', graph.y1)
            .attr('width', Math.abs(graph.x2 - graph.x1))
            .attr('height', Math.abs(graph.y2 - graph.y1))
            .style('fill', graph.background.fill || '#F8F8F8')
      })
    },
    drawGraphBottomBackground (svg, properties) {
      svg.select('#bottom-graph-background')
        .selectAll('rect')
        .data([0])
        .join('rect')
          .attr('x', properties.bottomGraph.x1)
          .attr('y', properties.bottomGraph.y1)
          .attr('width', Math.abs(properties.bottomGraph.x2 - properties.bottomGraph.x1))
          .attr('height', Math.abs(properties.bottomGraph.y2 - properties.bottomGraph.y1))
          .style('fill', '#F8F8F8')
    },
    drawGraphBottomYLAxis(svg, yLAxis) {
      svg.select('#bottom-graph-yl-axis')
        .attr('transform', yLAxis.transform)
        .style('font-size', '25px')
        .call(d3.axisLeft(yLAxis.scale).tickValues(yLAxis.tickValues).tickFormat((d, i) => Math.round(d * 100) + '%'))
    },
    drawGraphBottomYLKey(svg, yLAxis) {
      svg.select('#bottom-graph-data-key')
        .selectAll('text')
          .data(yLAxis.keys)
          .join('text')
            .attr('x', d => d.labelX)
            .attr('y', d => d.labelY)
            .text(d => d.label)

      svg.select('#bottom-graph-data-key')
        .selectAll('rect')
          .data(yLAxis.keys)
          .join('rect')
            .attr('x', d => d.labelX - 30)
            .attr('y', d => d.labelY - 18)
            .attr('width', 20)
            .attr('height', 20)
            .style('fill', d => d.colors.color)
    },
    drawGraphBottomYRAxis(svg, properties) {
      svg.select('#bottom-graph-yr-axis')
      .attr('transform', properties.bottomGraph.yRAxis.transform)
      .style('font-size', '25px')
      .call(d3.axisRight(properties.bottomGraph.yRAxis.scale).tickFormat(d3.format('~%')).ticks(4))
    },
    drawGraphTopBackground (svg, properties) {
      svg.select('#top-graph-background')
        .selectAll('rect')
        .data([0])
        .join('rect')
          .attr('x', properties.topGraph.x1)
          .attr('y', properties.topGraph.y1)
          .attr('width', Math.abs(properties.topGraph.x2 - properties.topGraph.x1))
          .attr('height', Math.abs(properties.topGraph.y2 - properties.topGraph.y1))
          .style('fill', '#F8F8F8')
    },

    drawGraphXAxis(svg, properties) {
      // add center X axis marks (dates)
      // top (includes tick marks only)


      // const ab = d3.axisBottom(properties.topGraph.xAxis.scale)
      //   .ticks(5)
      //   .offset(0)
      //   .tickFormat('')

      // ab(
      //   svg.select('#top-graph-x-axis').selectAll('g')
      //     .attr("transform", properties.topGraph.xAxis.transform)    
      //     .style("font-size", "25px")
      // )
        
      svg.select('#top-graph-x-axis')
        .attr("transform", properties.topGraph.xAxis.transform)    
        .style("font-size", "25px")
        .call(
          d3.axisBottom(properties.topGraph.xAxis.scale)
          .ticks(5)
          .offset(0)
          .tickFormat('')
        )
      // bottom (includes tick marks and labels)
      svg
        .select('#bottom-graph-x-axis')
        .attr("transform", properties.bottomGraph.xAxis.transform)    
        .style("font-size", "25px")
        .call(
          d3.axisTop(properties.bottomGraph.xAxis.scale)
          .ticks(5)
          .offset(0)
          .tickPadding(15)
          .tickFormat(d3.timeFormat("%e %b %y"))
        )
    },
    drawGraphMainLabels(svg, labels) {
      svg.select('#graph-labels')
        .style('font-size', '30px')
        .style('font-weight', '600')
        .selectAll('text')
          .data(labels)
          .join('text')
            .attr('x', d => d.x)
            .attr('y', d => d.y)
            .text(d => d.label)
            .style('text-anchor', d => d.textAnchor)
    },
    drawGraphTopYLabels(svg, labels) {
      svg.select('#top-graph-y-labels')
        .style('text-anchor', 'end')
        .selectAll('text')
          .data(Object.values(labels).filter(esv => esv.rowIndex !== undefined))
          .join('text')
            .attr('x', d => d.x)
            .attr('y', d => d.y)
            .text(d => d.label)
    },

    // pre-process the data to improve page rendering performance
    processCountries(countries) {
      return countries
    },
    processRegions(countries) {
      return Object.values(countries
        .reduce((regions, c) => {
          regions[c.wbRegionCode]
            ? regions[c.wbRegionCode].countries.push(c)
            : regions[c.wbRegionCode] = {
              id: c.wbRegionCode,
              label: c.wbRegion,
              countries: [c]
            } 
          return regions
        }, {}))
        .sort((a, b) => a.label.localeCompare(b.label))
    },
    initializeGraph() {
      const svg = d3.select('#chart')
        .attr('width', '100%')
        .attr('height', '100%')
        .attr('viewBox', `0 0 ${this.svgProperties.width} ${this.svgProperties.height}`)
        .attr('shape-rendering', 'crispEdges')
        // .style("border", "1px solid black")
        .style('font-family', 'sans-serif')
        .style('font-size', '25px')

      console.log(svg)

      // make sure all the groups are in place
      svg.selectAll('g')
        .data(this.svgProperties.groups)
        .join('g')
          .attr('id', d => d)

      // make sure all the axes are in place
      this.drawGraphBackgrounds(svg, [this.svgProperties.topGraph, this.svgProperties.bottomGraph])
      this.drawGraphMainLabels(svg, this.svgProperties.mainGraphLabels)
      this.drawGraphTopYLabels(svg, this.svgProperties.educationStatusValues)
      this.drawGraphBottomYLKey(svg, this.svgProperties.bottomGraph.yLAxis)
      this.drawGraphBottomYLAxis(svg, this.svgProperties.bottomGraph.yLAxis)
      this.drawGraphBottomYRAxis(svg, this.svgProperties)
      this.drawGraphXAxis(svg, this.svgProperties)
    },
    jumpToCountry (index) {
      this.selectedCountry = this.countries[index]
    },
    updateGraph() {
      const startTime = Date.now()
      const svg = d3.select('#chart')
      const graphData = this.displayedCountryGraphData
      const svgProperties = this.svgProperties

      this.drawCovidCases(svg.select('#bottom-graph-covid'), graphData.covidCasesPath)
      this.drawEducationStatusRectangles(svg.select('#top-graph-data'), graphData.educationStatusRectangles)
      this.drawInPersonPercentageLines(svg.select('#bottom-graph-data-lines'), graphData.inPersonPercentageLines.lines)

      console.log('graph updated in', Date.now() - startTime, ' ms')
    }
  }
});
</script>
  </body>
</html>
